<html>
<head>
<title>Photo Streamr</title>
<body>
<script src="/jquery-1.10.2.js"></script>
<script>
var ready = false;
$(window).on('message', function(e) {
    console.log('APP: ' + e.originalEvent.data);
    ready = true;
});
// owa_persona.js
var OWAPersona = function(params) {
    $('body').append('<iframe id="owapersona" src="' + params.iframe + '"></iframe>');

var win = window.frames[0];//$('#owapersona').get()[0].contentWindow;

    function initFrame() {
        if (ready) {
            // window.frames[0].postMessage('foo', 'http://localhost:6660/authenticate.html')

            console.log('sending a message to', params.iframe);
            win.postMessage('foobar', params.iframe);
        } else {
            console.log('sleep');
            setTimeout(initFrame, 100);
        }

    }

    setTimeout(initFrame, 100);

    var that = this;
    that.watch = function(wParams) {

    };
    return that;
};
</script>
<script>
// Code local to this app
$(document).ready(function(){
    var persona = new OWAPersona({
        iframe: 'http://localhost:6660/authentication.html',
        postAssertion: 'http://localhost:6660/verify_persona_assertion',
        siteName: 'Example Website',
        termsOfService: 'http://example.com/tos.html',
        privacyPolicy: 'http://example.com/privacy.html'
    });

    persona.watch({
        loggedInUser: currentUser(),
        onlogin: function(email) {

        },
        onlogout: function() {

        }
    });
});
function currentUser() {
    return null;
}
</script>
</body>
</html>